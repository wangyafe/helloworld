0.springboot Transactionäº‹åŠ¡çš„æ‰‹åŠ¨ç‰ˆ(ç¼–ç¨‹å¼äº‹åŠ¡)å’Œè‡ªåŠ¨ç‰ˆ(å£°æ˜å¼äº‹åŠ¡) https://blog.csdn.net/weixin_41725792/article/details/113619937?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-113619937-blog-94383010.pc_relevant_multi_platform_whitelistv2eslanding&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-113619937-blog-94383010.pc_relevant_multi_platform_whitelistv2eslanding&utm_relevant_index=2
1.ä¸¤ç§æ–¹å¼ï¼š
 1.1ä½¿ç”¨// äº‹åŠ¡ç®¡ç†å™¨
@Autowired
PlatformTransactionManager platformTransaction;
// äº‹åŠ¡å®šä¹‰  ï¼šäº‹åŠ¡çš„ä¸€äº›åŸºç¡€ä¿¡æ¯ï¼Œå¦‚è¶…æ—¶æ—¶é—´ã€éš”ç¦»çº§åˆ«ã€ä¼ æ’­å±æ€§ç­‰
@Autowired
TransactionDefinition transactionDefinition;

 1.2 ä½¿ç”¨äº‹åŠ¡æ¨¡æ¿
  @Autowired
private TransactionTemplate transactionTemplate;

2.// äº‹åŠ¡ç®¡ç†å™¨
@Autowired
PlatformTransactionManager platformTransaction;
// äº‹åŠ¡å®šä¹‰  ï¼šäº‹åŠ¡çš„ä¸€äº›åŸºç¡€ä¿¡æ¯ï¼Œå¦‚è¶…æ—¶æ—¶é—´ã€éš”ç¦»çº§åˆ«ã€ä¼ æ’­å±æ€§ç­‰
@Autowired
TransactionDefinition transactionDefinition;

public synchronized void test(){
// äº‹åŠ¡çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯ï¼Œå¦‚æ˜¯å¦ä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€æ˜¯å¦å·²è¢«æ ‡è®°ä¸ºå›æ»š
TransactionStatus transactionStatus = PlatformTransactionManager.getTransaction(transactionDefinition);
// æŸ¥è¯¢è®¢å•æ•°é‡
	queryProductCount();
// åˆ¤æ–­è®¢å•æ˜¯å¦>0
	if(){
		platformTransactionManager.rollback(transactionStatus);
		throw Exception();
	}
// æ›´æ–°åº“å­˜
	update();
// æ’å…¥ä¸€æ¡è®¢å•æ•°æ®	
	insert();
	platformTransactionManager.commit(transactionStatus);
}
3.@Autowired
private TransactionTemplate transactionTemplate;

public synchronized void test(){
// äº‹åŠ¡çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯ï¼Œå¦‚æ˜¯å¦ä¸€ä¸ªæ–°çš„äº‹åŠ¡ã€æ˜¯å¦å·²è¢«æ ‡è®°ä¸ºå›æ»š
        /*  å¦‚æœä½ çš„æ–¹æ³•éœ€è¦è¿”å›å€¼è¯·ä½¿ç”¨è¿™ä¸ªç±»
         *      new TransactionCallback<Object>()
         *
         *  å¦‚æœä½ çš„æ–¹æ³•ä¸éœ€è¦è¿”å›å€¼é‚£ä¹ˆä½¿ç”¨ğŸ‘‡ä¸‹é¢è¿™ä¸ªä¾‹å­å°±å¯ä»¥äº†
         *      new TransactionCallbackWithoutResult()
         */
		transactionTemplate.execute(new TransactionCallback<Object>() {
		            @Override
		            public Object doInTransaction(TransactionStatus transactionStatus) {
		                // æŸ¥è¯¢è®¢å•æ•°é‡
							queryProductCount();
						// åˆ¤æ–­è®¢å•æ˜¯å¦>0
							if(){
								platformTransactionManager.rollback(transactionStatus);
								throw Exception();
							}
						// æ›´æ–°åº“å­˜
							update();
						// æ’å…¥ä¸€æ¡è®¢å•æ•°æ®	
							insert();
		                return null;
		            }
		})
}

